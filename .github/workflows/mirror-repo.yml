name: Mirror Repository

on:
  push:
    branches:
      - '**'
  delete:
  workflow_dispatch:

jobs:
  mirror:
    runs-on: self-hosted
    name: Mirror to Personal Repositories

    steps:
      - name: Checkout source repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          fetch-tags: true
          persist-credentials: false

      - name: Configure Git
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"

      - name: Remove workflow files from mirror
        run: |
          git rm -r --cached .github/workflows/ || true
          git commit -m "chore: exclude workflows from mirror" || true

      # ============================================
      # Mirror vers les repos personnels
      # ============================================

      # Exemple de configuration pour les autres membres :
      # PRENOM_REPO_URL : github.com/username/repo-name.git
      # PRENOM_PAT : ghp_xxxxx (Scopes : repo)
      # DÃ©commenter et configurer les secrets appropriÃ©s

      # - name: Mirror to Laurent's Repository
      #   env:
      #     TARGET_REPO: ${{ secrets.LAURENT_REPO_URL }}
      #     TARGET_TOKEN: ${{ secrets.LAURENT_PAT }}
      #   if: env.TARGET_REPO != '' && env.TARGET_TOKEN != ''
      #   run: |
      #     git remote add laurent https://${TARGET_TOKEN}@${TARGET_REPO} || true
      #     git push laurent --all --force
      #     git push laurent --tags --force
      #   continue-on-error: true

      # - name: Mirror to William's Repository
      #   env:
      #     TARGET_REPO: ${{ secrets.WILLIAM_REPO_URL }}
      #     TARGET_TOKEN: ${{ secrets.WILLIAM_PAT }}
      #   if: env.TARGET_REPO != '' && env.TARGET_TOKEN != ''
      #   run: |
      #     git remote add william https://${TARGET_TOKEN}@${TARGET_REPO} || true
      #     git push william --all --force
      #     git push william --tags --force
      #   continue-on-error: true

      # - name: Mirror to Florian's Repository
      #   env:
      #     TARGET_REPO: ${{ secrets.FLORIAN_REPO_URL }}
      #     TARGET_TOKEN: ${{ secrets.FLORIAN_PAT }}
      #   if: env.TARGET_REPO != '' && env.TARGET_TOKEN != ''
      #   run: |
      #     git remote add florian https://${TARGET_TOKEN}@${TARGET_REPO} || true
      #     git push florian --all --force
      #     git push florian --tags --force
      #   continue-on-error: true

      # - name: Mirror to Noa's Repository
      #   env:
      #     TARGET_REPO: ${{ secrets.NOA_REPO_URL }}
      #     TARGET_TOKEN: ${{ secrets.NOA_PAT }}
      #   if: env.TARGET_REPO != '' && env.TARGET_TOKEN != ''
      #   run: |
      #     git remote add noa https://${TARGET_TOKEN}@${TARGET_REPO} || true
      #     git push noa --all --force
      #     git push noa --tags --force
      #   continue-on-error: true

      # - name: Mirror to Charly's Repository
      #   env:
      #     TARGET_REPO: ${{ secrets.CHARLY_REPO_URL }}
      #     TARGET_TOKEN: ${{ secrets.CHARLY_PAT }}
      #   if: env.TARGET_REPO != '' && env.TARGET_TOKEN != ''
      #   run: |
      #     git remote add charly https://${TARGET_TOKEN}@${TARGET_REPO} || true
      #     git push charly --all --force
      #     git push charly --tags --force
      #   continue-on-error: true

      - name: Mirror to RaphaÃ«l's Repository
        env:
          TARGET_REPO: ${{ secrets.RAPHAEL_REPO_URL }}
          TARGET_TOKEN: ${{ secrets.RAPHAEL_PAT }}
        if: env.TARGET_REPO != '' && env.TARGET_TOKEN != ''
        run: |
          git remote add raphael https://${TARGET_TOKEN}@${TARGET_REPO} || true
          git push raphael --all --force
          git push raphael --tags --force
        continue-on-error: true

      - name: Summary
        if: always()
        run: |
          echo "âœ… Mirror operation completed"
          echo "ðŸ“‹ Check individual steps for details"
